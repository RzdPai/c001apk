name: Flutter Multi-Platform Build

on:
  push:
    branches: [ main, master ]
    paths-ignore:
      - "README.md"
      - "docs/**"
      - "*.md"
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:
    inputs:
      release:
        description: 'Create GitHub Release'
        required: false
        default: 'false'
      version:
        description: 'Release Version'
        required: false
        default: ''
      skip_android:
        description: 'Skip Android build'
        required: false
        default: 'false'
      skip_windows:
        description: 'Skip Windows build'
        required: false
        default: 'false'
      skip_linux:
        description: 'Skip Linux build'
        required: false
        default: 'false'
      skip_macos:
        description: 'Skip macOS build'
        required: false
        default: 'false'

jobs:
  version:
    runs-on: ubuntu-latest
    outputs:
      version: ${{ steps.info.outputs.version }}
      app_name: ${{ steps.info.outputs.app_name }}
      DIST_WINDOWS_X64: ${{ steps.info.outputs.DIST_WINDOWS_X64 }}
      DIST_WINDOWS_ARM64: ${{ steps.info.outputs.DIST_WINDOWS_ARM64 }}
      DIST_LINUX_X64: ${{ steps.info.outputs.DIST_LINUX_X64 }}
      DIST_LINUX_ARM64: ${{ steps.info.outputs.DIST_LINUX_ARM64 }}
      DIST_MACOS_X64: ${{ steps.info.outputs.DIST_MACOS_X64 }}
      DIST_MACOS_ARM64: ${{ steps.info.outputs.DIST_MACOS_ARM64 }}
      DIST_ANDROID_X64: ${{ steps.info.outputs.DIST_ANDROID_X64 }}
      DIST_ANDROID_ARM64: ${{ steps.info.outputs.DIST_ANDROID_ARM64 }}
      DIST_ANDROID_ARM32: ${{ steps.info.outputs.DIST_ANDROID_ARM32 }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Get version from pubspec
        id: info
        run: |
          # ä»Ž pubspec.yaml è¯»å–åº”ç”¨ä¿¡æ¯
          VERSION=$(grep -m1 "version:" pubspec.yaml | cut -d' ' -f2)
          APP_NAME=$(grep -m1 "name:" pubspec.yaml | cut -d' ' -f2 | tr -d "'" || echo "flutter_app")
          
          # å¦‚æžœæ˜¯æ‰‹åŠ¨è¾“å…¥ç‰ˆæœ¬ï¼Œåˆ™ä½¿ç”¨è¾“å…¥çš„ç‰ˆæœ¬
          if [ "${{ github.event.inputs.release }}" == "true" ] && [ -n "${{ github.event.inputs.version }}" ]; then
            VERSION="${{ github.event.inputs.version }}"
          fi
          
          echo "version=${VERSION}" >> $GITHUB_OUTPUT
          echo "app_name=${APP_NAME}" >> $GITHUB_OUTPUT
          echo "DIST_WINDOWS_X64=${APP_NAME}-Windows-${VERSION}-x64" >> $GITHUB_OUTPUT
          echo "DIST_WINDOWS_ARM64=${APP_NAME}-Windows-${VERSION}-arm64" >> $GITHUB_OUTPUT
          echo "DIST_LINUX_X64=${APP_NAME}-Linux-${VERSION}-x64" >> $GITHUB_OUTPUT
          echo "DIST_LINUX_ARM64=${APP_NAME}-Linux-${VERSION}-arm64" >> $GITHUB_OUTPUT
          echo "DIST_MACOS_X64=${APP_NAME}-macOS-${VERSION}-x64" >> $GITHUB_OUTPUT
          echo "DIST_MACOS_ARM64=${APP_NAME}-macOS-${VERSION}-arm64" >> $GITHUB_OUTPUT
          echo "DIST_ANDROID_X64=${APP_NAME}-Android-${VERSION}-x64" >> $GITHUB_OUTPUT
          echo "DIST_ANDROID_ARM64=${APP_NAME}-Android-${VERSION}-arm64" >> $GITHUB_OUTPUT
          echo "DIST_ANDROID_ARM32=${APP_NAME}-Android-${VERSION}-arm32" >> $GITHUB_OUTPUT
          
          echo "Version: ${VERSION}"
          echo "App Name: ${APP_NAME}"

  build-android:
    name: Build Android (${{ matrix.abi }})
    needs: [version]
    if: github.event.inputs.skip_android != 'true'
    strategy:
      fail-fast: false
      matrix:
        include:
          - abi: arm64-v8a
            arch: arm64
            target: android-arm64
          - abi: armeabi-v7a
            arch: arm32
            target: android-arm
          - abi: x86_64
            arch: x64
            target: android-x64
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - uses: subosito/flutter-action@v2
        with:
          flutter-version: 3.22.0
          channel: stable
          cache: true
          cache-key: flutter-${{ runner.os }}-${{ hashFiles('pubspec.lock') }}
          cache-path: ${{ runner.tool_cache }}/flutter

      - uses: actions/setup-java@v4
        with:
          java-version: 17
          distribution: 'temurin'

      - name: Fix Android Gradle versions
        run: |
          cd android
          
          # å¤‡ä»½åŽŸå§‹æ–‡ä»¶
          cp build.gradle build.gradle.backup
          cp app/build.gradle app/build.gradle.backup
          
          # æ›´æ–°æ ¹ç›®å½• build.gradle
          sed -i 's/com.android.tools.build:gradle:[0-9\.]*/com.android.tools.build:gradle:8.9.1/' build.gradle
          sed -i 's/ext.kotlin_version = "[0-9\.]*"/ext.kotlin_version = "2.1.0"/' build.gradle
          sed -i 's/org.jetbrains.kotlin:kotlin-gradle-plugin:[0-9\.]*/org.jetbrains.kotlin:kotlin-gradle-plugin:2.1.0/' build.gradle
          
          # æ›´æ–° app/build.gradle
          sed -i 's/compileSdk [0-9]*/compileSdk 35/' app/build.gradle
          sed -i 's/minSdkVersion [0-9]*/minSdkVersion 21/' app/build.gradle
          sed -i 's/targetSdkVersion [0-9]*/targetSdkVersion 35/' app/build.gradle
          
          # æ›´æ–° gradle wrapper
          sed -i 's/gradle-[0-9\.]*-bin.zip/gradle-8.9-bin.zip/' gradle/wrapper/gradle-wrapper.properties
          
          cd ..

      - name: Install dependencies
        run: |
          flutter pub get
          flutter pub run build_runner build --delete-conflicting-outputs || true

      - name: Build Android APK
        run: |
          # æ¸…ç†æž„å»ºç¼“å­˜
          flutter clean
          
          # æž„å»ºç‰¹å®šæž¶æž„çš„ APK
          flutter build apk --release \
            --target-platform=${{ matrix.target }} \
            --split-per-abi \
            --dart-define=BUILD_ARCH=${{ matrix.arch }} \
            --dart-define=BUILD_NUMBER=${{ github.run_number }}

      - name: Rename APK file
        run: |
          # æ ¹æ®æž¶æž„é‡å‘½å APK æ–‡ä»¶
          if [ "${{ matrix.arch }}" = "arm64" ]; then
            cp build/app/outputs/flutter-apk/app-arm64-v8a-release.apk build/app/outputs/flutter-apk/${{ needs.version.outputs.app_name }}-android-${{ needs.version.outputs.version }}-arm64.apk
          elif [ "${{ matrix.arch }}" = "arm32" ]; then
            cp build/app/outputs/flutter-apk/app-armeabi-v7a-release.apk build/app/outputs/flutter-apk/${{ needs.version.outputs.app_name }}-android-${{ needs.version.outputs.version }}-arm32.apk
          elif [ "${{ matrix.arch }}" = "x64" ]; then
            cp build/app/outputs/flutter-apk/app-x86_64-release.apk build/app/outputs/flutter-apk/${{ needs.version.outputs.app_name }}-android-${{ needs.version.outputs.version }}-x64.apk
          fi

      - name: Upload Android Artifact
        uses: actions/upload-artifact@v4
        with:
          name: Android-${{ matrix.arch }}
          path: |
            build/app/outputs/flutter-apk/*${{ matrix.arch }}*.apk
            build/app/outputs/flutter-apk/output.json
          retention-days: 7
          compression-level: 9

  build-windows:
    name: Build Windows (${{ matrix.arch }})
    needs: [version]
    if: github.event.inputs.skip_windows != 'true'
    strategy:
      fail-fast: false
      matrix:
        include:
          - arch: x64
            runner: windows-latest
            channel: stable
            flutter_target: windows-x64
            output_dir: x64
          - arch: arm64
            runner: windows-11-arm
            channel: beta
            flutter_target: windows-arm64
            output_dir: arm64
    runs-on: ${{ matrix.runner }}
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ matrix.arch == 'arm64' && '3.22.0' || '3.22.0' }}
          channel: ${{ matrix.channel }}
          cache: true
          cache-key: flutter-windows-${{ matrix.arch }}-${{ hashFiles('pubspec.lock') }}

      - name: Setup MSVC for ARM64
        if: matrix.arch == 'arm64'
        uses: ilammy/msvc-dev-cmd@v1
        with:
          arch: arm64
          uwp: false
          spectre: true

      - name: Install dependencies
        run: |
          flutter pub get
          flutter pub run build_runner build --delete-conflicting-outputs || true

      - name: Enable Windows desktop
        run: flutter config --enable-windows-desktop

      - name: Build Windows ${{ matrix.arch }}
        run: |
          # æ¸…ç†å¹¶æž„å»º
          flutter clean
          
          echo "Building for Windows ${{ matrix.arch }}..."
          
          # ä½¿ç”¨ dart-define ä¼ é€’æž¶æž„ä¿¡æ¯
          flutter build windows \
            --release \
            --dart-define=BUILD_ARCH=${{ matrix.arch }} \
            --dart-define=BUILD_NUMBER=${{ github.run_number }} \
            --verbose
          
          # åˆ—å‡ºæž„å»ºæ–‡ä»¶ç¡®è®¤
          dir build/windows -Recurse

      - name: Package Windows build
        run: |
          # åˆ›å»ºç‰ˆæœ¬ç‰¹å®šçš„ç›®å½•
          $APP_NAME="${{ needs.version.outputs.app_name }}"
          $VERSION="${{ needs.version.outputs.version }}"
          $ARCH="${{ matrix.arch }}"
          
          # ç¡®å®šè¾“å‡ºç›®å½•
          $RELEASE_DIR="build/windows/runner/Release"
          if (Test-Path "build/windows/${{ matrix.output_dir }}/runner/Release") {
            $RELEASE_DIR="build/windows/${{ matrix.output_dir }}/runner/Release"
          }
          
          # åˆ›å»ºåˆ†å‘ç›®å½•
          $DIST_DIR="dist/windows-$ARCH"
          New-Item -ItemType Directory -Force -Path $DIST_DIR
          
          # å¤åˆ¶æ‰€æœ‰å¿…è¦çš„æ–‡ä»¶
          Copy-Item -Path "$RELEASE_DIR/*.exe" -Destination $DIST_DIR
          Copy-Item -Path "$RELEASE_DIR/*.dll" -Destination $DIST_DIR
          Copy-Item -Path "$RELEASE_DIR/data/" -Destination $DIST_DIR/data -Recurse -Force
          
          # å¤åˆ¶ README å’Œè®¸å¯æ–‡ä»¶
          Copy-Item -Path "README.md" -Destination $DIST_DIR -ErrorAction SilentlyContinue
          Copy-Item -Path "LICENSE" -Destination $DIST_DIR -ErrorAction SilentlyContinue
          
          # åˆ›å»ºåŽ‹ç¼©åŒ…
          Compress-Archive -Path "$DIST_DIR/*" -DestinationPath "build/$APP_NAME-windows-$VERSION-$ARCH.zip" -CompressionLevel Optimal

      - name: Upload Windows Artifact
        uses: actions/upload-artifact@v4
        with:
          name: Windows-${{ matrix.arch }}
          path: |
            build/${{ needs.version.outputs.app_name }}-windows-${{ needs.version.outputs.version }}-${{ matrix.arch }}.zip
            build/windows/runner/Release/*.exe
          retention-days: 7
          compression-level: 9

  build-linux:
    name: Build Linux (${{ matrix.arch }})
    needs: [version]
    if: github.event.inputs.skip_linux != 'true'
    strategy:
      fail-fast: false
      matrix:
        include:
          - arch: x64
            runner: ubuntu-latest
            channel: stable
          - arch: arm64
            runner: ubuntu-24.04-arm
            channel: stable
    runs-on: ${{ matrix.runner }}
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - uses: subosito/flutter-action@v2
        with:
          flutter-version: 3.22.0
          channel: ${{ matrix.channel }}
          cache: true
          cache-key: flutter-linux-${{ matrix.arch }}-${{ hashFiles('pubspec.lock') }}

      - name: Install Linux dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            clang \
            cmake \
            ninja-build \
            pkg-config \
            libgtk-3-dev \
            liblzma-dev \
            libstdc++-12-dev \
            libglu1-mesa-dev \
            libegl1-mesa-dev
            
          # ARM64 ç‰¹å®šä¾èµ–
          if [ "${{ matrix.arch }}" = "arm64" ]; then
            sudo apt-get install -y \
              gcc-aarch64-linux-gnu \
              g++-aarch64-linux-gnu \
              libc6-dev-arm64-cross
          fi

      - name: Install dependencies
        run: |
          flutter pub get
          flutter pub run build_runner build --delete-conflicting-outputs || true

      - name: Enable Linux desktop
        run: flutter config --enable-linux-desktop

      - name: Build Linux ${{ matrix.arch }}
        run: |
          # æ¸…ç†å¹¶æž„å»º
          flutter clean
          
          echo "Building for Linux ${{ matrix.arch }}..."
          
          flutter build linux \
            --release \
            --dart-define=BUILD_ARCH=${{ matrix.arch }} \
            --dart-define=BUILD_NUMBER=${{ github.run_number }} \
            --verbose

      - name: Package Linux build
        run: |
          APP_NAME="${{ needs.version.outputs.app_name }}"
          VERSION="${{ needs.version.outputs.version }}"
          ARCH="${{ matrix.arch }}"
          
          # è¿›å…¥æž„å»ºç›®å½•
          cd "build/linux/$ARCH/release/bundle"
          
          # åˆ›å»ºåŽ‹ç¼©åŒ…
          tar -czf "../../../../$APP_NAME-linux-$VERSION-$ARCH.tar.gz" .
          
          # è¿”å›žé¡¹ç›®æ ¹ç›®å½•
          cd ../../../../..

      - name: Upload Linux Artifact
        uses: actions/upload-artifact@v4
        with:
          name: Linux-${{ matrix.arch }}
          path: |
            build/${{ needs.version.outputs.app_name }}-linux-${{ needs.version.outputs.version }}-${{ matrix.arch }}.tar.gz
            build/linux/${{ matrix.arch }}/release/bundle/
          retention-days: 7
          compression-level: 9

  build-macos:
    name: Build macOS (${{ matrix.arch }})
    needs: [version]
    if: github.event.inputs.skip_macos != 'true'
    strategy:
      fail-fast: false
      matrix:
        include:
          - arch: x64
            target: darwin-x64
          - arch: arm64
            target: darwin-arm64
    runs-on: macos-14
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - uses: subosito/flutter-action@v2
        with:
          flutter-version: 3.22.0
          channel: stable
          cache: true
          cache-key: flutter-macos-${{ matrix.arch }}-${{ hashFiles('pubspec.lock') }}

      - name: Install macOS dependencies
        run: |
          brew update
          brew install create-dmg || true

      - name: Install dependencies
        run: |
          flutter pub get
          flutter pub run build_runner build --delete-conflicting-outputs || true

      - name: Enable macOS desktop
        run: flutter config --enable-macos-desktop

      - name: Build macOS ${{ matrix.arch }}
        run: |
          # æ¸…ç†å¹¶æž„å»º
          flutter clean
          
          echo "Building for macOS ${{ matrix.arch }}..."
          
          # è®¾ç½®æž¶æž„ç‰¹å®šçš„çŽ¯å¢ƒå˜é‡
          if [ "${{ matrix.arch }}" = "arm64" ]; then
            export SDKROOT=$(xcrun --sdk macosx --show-sdk-path)
            export MACOSX_DEPLOYMENT_TARGET=11.0
          else
            export MACOSX_DEPLOYMENT_TARGET=10.14
          fi
          
          flutter build macos \
            --release \
            --dart-define=BUILD_ARCH=${{ matrix.arch }} \
            --dart-define=BUILD_NUMBER=${{ github.run_number }} \
            --verbose

      - name: Create DMG for ${{ matrix.arch }}
        run: |
          APP_NAME="${{ needs.version.outputs.app_name }}"
          VERSION="${{ needs.version.outputs.version }}"
          ARCH="${{ matrix.arch }}"
          
          # è¿›å…¥åº”ç”¨ç›®å½•
          cd "build/macos/Build/Products/Release"
          
          # åˆ›å»ºä¸´æ—¶ç›®å½•
          mkdir -p dmg_temp
          cp -R "$APP_NAME.app" dmg_temp/
          
          # åˆ›å»º DMG
          if command -v create-dmg &> /dev/null; then
            create-dmg \
              --volname "$APP_NAME $VERSION" \
              --volicon "../../../../assets/icon.icns" \
              --window-pos 200 120 \
              --window-size 800 400 \
              --icon-size 100 \
              --icon "$APP_NAME.app" 200 190 \
              --hide-extension "$APP_NAME.app" \
              --app-drop-link 600 185 \
              "../../../../build/$APP_NAME-macos-$VERSION-$ARCH.dmg" \
              dmg_temp/
          else
            # å¤‡ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨ hdiutil
            hdiutil create \
              -volname "$APP_NAME $VERSION" \
              -srcfolder dmg_temp \
              -ov \
              -format UDZO \
              "../../../../build/$APP_NAME-macos-$VERSION-$ARCH.dmg"
          fi

      - name: Upload macOS Artifact
        uses: actions/upload-artifact@v4
        with:
          name: macOS-${{ matrix.arch }}
          path: |
            build/${{ needs.version.outputs.app_name }}-macos-${{ needs.version.outputs.version }}-${{ matrix.arch }}.dmg
            build/macos/Build/Products/Release/${{ needs.version.outputs.app_name }}.app
          retention-days: 7
          compression-level: 9

  release:
    name: Create Release
    needs: [version, build-android, build-windows, build-linux, build-macos]
    if: github.event.inputs.release == 'true'
    runs-on: ubuntu-latest
    steps:
      - name: Download all artifacts
        uses: actions/download-artifact@v4
        with:
          path: artifacts
          pattern: '*'
          merge-multiple: true

      - name: List downloaded artifacts
        run: |
          echo "Downloaded artifacts:"
          find artifacts -type f -name "*" | sort
          echo ""
          echo "File sizes:"
          find artifacts -type f -name "*" -exec du -h {} \;

      - name: Prepare release assets
        run: |
          mkdir -p release_assets
          
          # ç§»åŠ¨æ‰€æœ‰æž„å»ºæ–‡ä»¶åˆ°å‘å¸ƒç›®å½•
          find artifacts -name "*.apk" -exec cp {} release_assets/ \;
          find artifacts -name "*.zip" -exec cp {} release_assets/ \;
          find artifacts -name "*.tar.gz" -exec cp {} release_assets/ \;
          find artifacts -name "*.dmg" -exec cp {} release_assets/ \;
          
          # é‡å‘½åæ–‡ä»¶ä½¿å…¶æ›´å‹å¥½
          cd release_assets
          for file in *; do
            if [[ "$file" == *"flutter_app"* ]]; then
              new_name="${file/flutter_app/${{ needs.version.outputs.app_name }}}"
              mv "$file" "$new_name"
            fi
          done
          
          # åˆ›å»ºæ ¡éªŒå’Œæ–‡ä»¶
          sha256sum * > SHA256SUMS.txt
          cat SHA256SUMS.txt

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          name: Release v${{ needs.version.outputs.version }}
          tag_name: v${{ needs.version.outputs.version }}
          body: |
            ## ðŸš€ Release v${{ needs.version.outputs.version }}
            
            ### ðŸ“¦ Download Links
            
            | Platform | Architecture | Download |
            |----------|--------------|----------|
            | **Android** | ARM64 | [ä¸‹è½½](https://github.com/${{ github.repository }}/releases/download/v${{ needs.version.outputs.version }}/${{ needs.version.outputs.app_name }}-android-${{ needs.version.outputs.version }}-arm64.apk) |
            | **Android** | ARM32 | [ä¸‹è½½](https://github.com/${{ github.repository }}/releases/download/v${{ needs.version.outputs.version }}/${{ needs.version.outputs.app_name }}-android-${{ needs.version.outputs.version }}-arm32.apk) |
            | **Windows** | x64 | [ä¸‹è½½](https://github.com/${{ github.repository }}/releases/download/v${{ needs.version.outputs.version }}/${{ needs.version.outputs.app_name }}-windows-${{ needs.version.outputs.version }}-x64.zip) |
            | **Windows** | ARM64 | [ä¸‹è½½](https://github.com/${{ github.repository }}/releases/download/v${{ needs.version.outputs.version }}/${{ needs.version.outputs.app_name }}-windows-${{ needs.version.outputs.version }}-arm64.zip) |
            | **Linux** | x64 | [ä¸‹è½½](https://github.com/${{ github.repository }}/releases/download/v${{ needs.version.outputs.version }}/${{ needs.version.outputs.app_name }}-linux-${{ needs.version.outputs.version }}-x64.tar.gz) |
            | **Linux** | ARM64 | [ä¸‹è½½](https://github.com/${{ github.repository }}/releases/download/v${{ needs.version.outputs.version }}/${{ needs.version.outputs.app_name }}-linux-${{ needs.version.outputs.version }}-arm64.tar.gz) |
            | **macOS** | x64 | [ä¸‹è½½](https://github.com/${{ github.repository }}/releases/download/v${{ needs.version.outputs.version }}/${{ needs.version.outputs.app_name }}-macos-${{ needs.version.outputs.version }}-x64.dmg) |
            | **macOS** | ARM64 | [ä¸‹è½½](https://github.com/${{ github.repository }}/releases/download/v${{ needs.version.outputs.version }}/${{ needs.version.outputs.app_name }}-macos-${{ needs.version.outputs.version }}-arm64.dmg) |
            
            ### ðŸ”’ Checksums
            ```
            $(cat release_assets/SHA256SUMS.txt)
            ```
            
            ### ðŸ“ Build Information
            - **Build Number:** ${{ github.run_number }}
            - **Commit:** ${{ github.sha }}
            - **Build Date:** $(date -u +"%Y-%m-%dT%H:%M:%SZ")
            
          draft: false
          prerelease: ${{ contains(needs.version.outputs.version, '-') || contains(needs.version.outputs.version, 'beta') || contains(needs.version.outputs.version, 'alpha') }}
          files: |
            release_assets/*
          generate_release_notes: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  notify:
    name: Notify Build Status
    needs: [build-android, build-windows, build-linux, build-macos]
    if: always()
    runs-on: ubuntu-latest
    steps:
      - name: Build Status Summary
        run: |
          echo "## Build Status Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Job | Status |" >> $GITHUB_STEP_SUMMARY
          echo "|-----|--------|" >> $GITHUB_STEP_SUMMARY
          
          echo "| Android | ${{ needs.build-android.result }} |" >> $GITHUB_STEP_SUMMARY
          echo "| Windows | ${{ needs.build-windows.result }} |" >> $GITHUB_STEP_SUMMARY
          echo "| Linux | ${{ needs.build-linux.result }} |" >> $GITHUB_STEP_SUMMARY
          echo "| macOS | ${{ needs.build-macos.result }} |" >> $GITHUB_STEP_SUMMARY
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Build Number:** ${{ github.run_number }}" >> $GITHUB_STEP_SUMMARY
          echo "**Commit:** ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
          echo "**Run URL:** https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}" >> $GITHUB_STEP_SUMMARY